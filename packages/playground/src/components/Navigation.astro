---
interface Props {
	currentPath?: string
}

const { currentPath = '' } = Astro.props
const path = currentPath || Astro.url.pathname

const contentLinks = [
	{ href: '/blog/', label: 'Blog' },
	{ href: '/projects/', label: 'Projects' },
	{ href: '/team/', label: 'Team' },
	{ href: '/services/', label: 'Services' },
]

const packageLinks = [
	{ href: '/components/', label: 'Components' },
	{ href: '/cms/', label: 'CMS' },
	{ href: '/llm-enhancements/', label: 'LLM' },
	{ href: '/agent-summary/', label: 'Agents' },
	{ href: '/nua/', label: 'Nua' },
	{ href: '/cli/', label: 'CLI' },
]

const allLinks = [{ href: '/', label: 'Home' }, ...contentLinks, ...packageLinks]

function isActive(href: string) {
	if (href === '/') return path === '/' || path === ''
	return path.startsWith(href)
}

function isGroupActive(links: { href: string }[]) {
	return links.some(l => isActive(l.href))
}
---

<nav class="sticky top-0 z-50 border-b border-slate-800/80 bg-slate-950/80 backdrop-blur-xl">
	<div class="mx-auto flex max-w-6xl items-center justify-between px-6 py-3">
		<a href="/" class="flex items-center gap-2.5 text-sm font-semibold text-slate-100 transition hover:text-white">
			<span class="flex h-7 w-7 items-center justify-center rounded-lg bg-indigo-500/20 text-xs font-bold text-indigo-300">N</span>
			<span>Nua Playground</span>
		</a>

		<button
			id="nav-toggle"
			class="flex h-8 w-8 items-center justify-center rounded-lg border border-slate-700 bg-slate-800/60 text-slate-400 transition hover:border-slate-600 hover:text-slate-200 lg:hidden"
			aria-label="Toggle navigation"
			aria-expanded="false"
		>
			<svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
				<path id="nav-icon-open" stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
				<path id="nav-icon-close" class="hidden" stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
			</svg>
		</button>

		<!-- Desktop nav -->
		<div class="hidden lg:flex lg:items-center lg:gap-1">
			<a
				href="/"
				class:list={[
					'rounded-md px-3 py-1.5 text-sm transition',
					isActive('/')
						? 'bg-indigo-500/15 font-medium text-indigo-200'
						: 'text-slate-400 hover:bg-slate-800/60 hover:text-slate-200',
				]}
			>
				Home
			</a>

			<!-- Content dropdown -->
			<div class="nav-dropdown relative">
				<button
					class:list={[
						'nav-dropdown-trigger flex items-center gap-1 rounded-md px-3 py-1.5 text-sm transition',
						isGroupActive(contentLinks)
							? 'bg-indigo-500/15 font-medium text-indigo-200'
							: 'text-slate-400 hover:bg-slate-800/60 hover:text-slate-200',
					]}
				>
					Content
					<svg class="h-3 w-3 opacity-50" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
						<path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
					</svg>
				</button>
				<div class="nav-dropdown-menu absolute left-0 top-full hidden pt-1">
					<div class="min-w-[10rem] rounded-lg border border-slate-800 bg-slate-950 p-1 shadow-xl shadow-black/40">
						{contentLinks.map(({ href, label }) => (
							<a
								href={href}
								class:list={[
									'block rounded-md px-3 py-1.5 text-sm transition',
									isActive(href)
										? 'bg-indigo-500/15 font-medium text-indigo-200'
										: 'text-slate-400 hover:bg-slate-800/60 hover:text-slate-200',
								]}
							>
								{label}
							</a>
						))}
					</div>
				</div>
			</div>

			<!-- Packages dropdown -->
			<div class="nav-dropdown relative">
				<button
					class:list={[
						'nav-dropdown-trigger flex items-center gap-1 rounded-md px-3 py-1.5 text-sm transition',
						isGroupActive(packageLinks)
							? 'bg-indigo-500/15 font-medium text-indigo-200'
							: 'text-slate-400 hover:bg-slate-800/60 hover:text-slate-200',
					]}
				>
					Packages
					<svg class="h-3 w-3 opacity-50" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
						<path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
					</svg>
				</button>
				<div class="nav-dropdown-menu absolute left-0 top-full hidden pt-1">
					<div class="min-w-[10rem] rounded-lg border border-slate-800 bg-slate-950 p-1 shadow-xl shadow-black/40">
						{packageLinks.map(({ href, label }) => (
							<a
								href={href}
								class:list={[
									'block rounded-md px-3 py-1.5 text-sm transition',
									isActive(href)
										? 'bg-indigo-500/15 font-medium text-indigo-200'
										: 'text-slate-400 hover:bg-slate-800/60 hover:text-slate-200',
								]}
							>
								{label}
							</a>
						))}
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Mobile nav -->
	<div id="nav-mobile" class="hidden border-t border-slate-800/60 px-6 pb-4 pt-2 lg:hidden">
		<a
			href="/"
			class:list={[
				'block rounded-md px-3 py-2 text-sm transition',
				isActive('/')
					? 'bg-indigo-500/15 font-medium text-indigo-200'
					: 'text-slate-400 hover:bg-slate-800/60 hover:text-slate-200',
			]}
		>
			Home
		</a>

		<div class="mt-2 mb-1 px-3 text-[11px] font-semibold uppercase tracking-wider text-slate-600">Content</div>
		{contentLinks.map(({ href, label }) => (
			<a
				href={href}
				class:list={[
					'block rounded-md px-3 py-2 text-sm transition',
					isActive(href)
						? 'bg-indigo-500/15 font-medium text-indigo-200'
						: 'text-slate-400 hover:bg-slate-800/60 hover:text-slate-200',
				]}
			>
				{label}
			</a>
		))}

		<div class="mt-2 mb-1 px-3 text-[11px] font-semibold uppercase tracking-wider text-slate-600">Packages</div>
		{packageLinks.map(({ href, label }) => (
			<a
				href={href}
				class:list={[
					'block rounded-md px-3 py-2 text-sm transition',
					isActive(href)
						? 'bg-indigo-500/15 font-medium text-indigo-200'
						: 'text-slate-400 hover:bg-slate-800/60 hover:text-slate-200',
				]}
			>
				{label}
			</a>
		))}
	</div>
</nav>

<script>
	// Mobile toggle
	const toggle = document.getElementById('nav-toggle')!
	const mobile = document.getElementById('nav-mobile')!
	const iconOpen = document.getElementById('nav-icon-open')!
	const iconClose = document.getElementById('nav-icon-close')!

	toggle.addEventListener('click', () => {
		const open = mobile.classList.toggle('hidden')
		iconOpen.classList.toggle('hidden', !open)
		iconClose.classList.toggle('hidden', open)
		toggle.setAttribute('aria-expanded', String(!open))
	})

	// Desktop dropdowns
	document.querySelectorAll('.nav-dropdown').forEach(dropdown => {
		const trigger = dropdown.querySelector('.nav-dropdown-trigger')!
		const menu = dropdown.querySelector('.nav-dropdown-menu')!
		let timeout: ReturnType<typeof setTimeout>

		const show = () => { clearTimeout(timeout); menu.classList.remove('hidden') }
		const hide = () => { timeout = setTimeout(() => menu.classList.add('hidden'), 150) }

		trigger.addEventListener('mouseenter', show)
		trigger.addEventListener('mouseleave', hide)
		menu.addEventListener('mouseenter', show)
		menu.addEventListener('mouseleave', hide)
		trigger.addEventListener('click', () => menu.classList.toggle('hidden'))
	})
</script>

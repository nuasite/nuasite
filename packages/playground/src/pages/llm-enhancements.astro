---
import DocLayout from '../components/DocLayout.astro'
import PageHeader from '../components/PageHeader.astro'
import SectionHeading from '../components/SectionHeading.astro'
import CodeBlock from '../components/CodeBlock.astro'
import ConfigTable from '../components/ConfigTable.astro'
import OutputViewer from '../components/OutputViewer.astro'

import fs from 'node:fs'
import path from 'node:path'

let llmsTxt = ''
try {
	llmsTxt = fs.readFileSync(path.resolve('dist/llms.txt'), 'utf-8').slice(0, 3000)
} catch {
	llmsTxt = '# llms.txt will be generated after build\n# Run `nua build` to generate this file.'
}

let llmMd = ''
try {
	llmMd = fs.readFileSync(path.resolve('dist/.well-known/llm.md'), 'utf-8').slice(0, 3000)
} catch {
	llmMd = '# llm.md will be generated after build\n# Run `nua build` to generate this file.'
}

const configRows = [
	{ name: 'contentDir', type: 'string', default: '"src/content"', description: 'Directory for content collections to expose as markdown.' },
	{ name: 'includeStaticPages', type: 'boolean', default: 'true', description: 'Include non-collection pages in markdown generation.' },
	{ name: 'includeFrontmatter', type: 'boolean', default: 'true', description: 'Include YAML frontmatter block in generated markdown files.' },
	{ name: 'llmEndpoint', type: 'boolean | LlmEndpointOptions', default: 'true', description: 'Enable /.well-known/llm.md discovery endpoint.' },
	{ name: 'llmsTxt', type: 'boolean | LlmsTxtOptions', default: 'true', description: 'Enable /llms.txt protocol endpoint.' },
]

const llmEndpointRows = [
	{ name: 'siteName', type: 'string', description: 'Site name override for the endpoint.' },
	{ name: 'description', type: 'string', description: 'Site description override.' },
	{ name: 'baseUrl', type: 'string', description: 'Base URL override (defaults to Astro site config).' },
	{ name: 'additionalContent', type: 'string', description: 'Additional content to append to the endpoint.' },
]

const tryItLinks = [
	{ label: 'This page as Markdown', href: '/llm-enhancements.md' },
	{ label: 'Homepage as Markdown', href: '/index.md' },
	{ label: 'CMS docs as Markdown', href: '/cms.md' },
	{ label: 'llms.txt', href: '/llms.txt' },
	{ label: '/.well-known/llm.md', href: '/.well-known/llm.md' },
]
---

<DocLayout title="LLM Enhancements | Nua Playground" description="Expose Astro pages as .md endpoints for LLM/AI processing.">
	<PageHeader
		badge="@nuasite/llm-enhancements"
		title="Pages that speak Markdown."
		description="Automatically expose every Astro page as a .md endpoint, generate llms.txt, and publish a /.well-known/llm.md discovery file — making your site natively accessible to language models."
	/>

	<div class="mx-auto max-w-6xl space-y-16 px-6 py-16">

		<section class="space-y-8">
			<SectionHeading
				title="Try it — live"
				description="This playground has LLM enhancements active. Every page has a .md counterpart."
				id="try-it"
			/>
			<div class="flex flex-wrap gap-3">
				{tryItLinks.map(({ label, href }) => (
					<a
						href={href}
						target="_blank"
						rel="noopener noreferrer"
						class="inline-flex items-center gap-2 rounded-lg border border-slate-700 bg-slate-800/60 px-4 py-2.5 text-sm text-slate-300 transition hover:border-indigo-500/40 hover:bg-slate-800 hover:text-white"
					>
						{label}
						<svg class="h-3.5 w-3.5 text-slate-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
							<path stroke-linecap="round" stroke-linejoin="round" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
						</svg>
					</a>
				))}
			</div>
		</section>

		<section class="space-y-8">
			<SectionHeading
				title="Live output: llms.txt"
				description="The playground's own /llms.txt, generated at build time."
				id="llms-txt"
			/>
			<OutputViewer title="Live output" filename="llms.txt" content={llmsTxt} />
		</section>

		<section class="space-y-8">
			<SectionHeading
				title="Live output: llm.md"
				description="The playground's /.well-known/llm.md discovery endpoint."
				id="llm-md"
			/>
			<OutputViewer title="Live output" filename=".well-known/llm.md" content={llmMd} />
		</section>

		<section class="space-y-8">
			<SectionHeading
				title="How it works"
				description="Three layers of LLM accessibility."
				id="how-it-works"
			/>
			<div class="grid gap-6 lg:grid-cols-3">
				<div class="rounded-2xl border border-slate-800 bg-slate-900/60 p-6 space-y-3">
					<h3 class="text-sm font-semibold text-white">.md endpoints</h3>
					<p class="text-sm text-slate-400">Every HTML page gets a parallel <code class="rounded border border-slate-700 bg-slate-900 px-1 py-0.5 text-xs">.md</code> file. Content pages use raw markdown; static pages are converted from HTML.</p>
				</div>
				<div class="rounded-2xl border border-slate-800 bg-slate-900/60 p-6 space-y-3">
					<h3 class="text-sm font-semibold text-white">llms.txt protocol</h3>
					<p class="text-sm text-slate-400">A <code class="rounded border border-slate-700 bg-slate-900 px-1 py-0.5 text-xs">/llms.txt</code> file listing all available markdown endpoints with metadata and crawling rules.</p>
				</div>
				<div class="rounded-2xl border border-slate-800 bg-slate-900/60 p-6 space-y-3">
					<h3 class="text-sm font-semibold text-white">LLM discovery</h3>
					<p class="text-sm text-slate-400">A <code class="rounded border border-slate-700 bg-slate-900 px-1 py-0.5 text-xs">/.well-known/llm.md</code> endpoint with site name, description, and page index for agent consumption.</p>
				</div>
			</div>
		</section>

		<section class="space-y-8">
			<SectionHeading title="Configuration" id="config" />
			<CodeBlock
				filename="astro.config.ts"
				code={`import { defineConfig } from '@nuasite/nua/config'

export default defineConfig({
  pageMarkdown: {
    includeStaticPages: true,
    llmsTxt: {
      siteName: 'My Site',
      instructions: 'Focus on technical documentation pages.',
    },
    llmEndpoint: {
      siteName: 'My Site',
      description: 'Product documentation and guides.',
    },
  },
})`}
			/>
			<ConfigTable title="PageMarkdownOptions" rows={configRows} />
			<ConfigTable title="LlmEndpointOptions / LlmsTxtOptions" rows={llmEndpointRows} />
		</section>

	</div>
</DocLayout>
